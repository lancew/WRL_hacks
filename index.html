<html>
<head>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-url-parser/2.3.1/purl.min.js"></script>
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">


  
</head>

<body>

<div id='text'></div>

<script>
limit = $.url().param('limit') || 3;
$.getJSON('https://data.judobase.org/api/get_json?params[action]=wrl.by_category&params[category_limit]=' + limit, function(data) {
	//console.log(data);
	//console.log(data.categories[1].name);
	console.log($.url().param('country'));
	var total_athletes = 0;
	var top_mover = (delta: 0, athlete: '');
	
	$.each(data.categories, function(index, value){
		$('#text').append( '<h2>' + value.name + '</h2>' );
		$.each(value.competitors, function(index2, athlete) {
			if (athlete.country_short == $.url().param('country') || !$.url().param('country') ) {

				var delta =Math.abs(athlete.place - athlete.place_prev);
				if (top_mover.delta < delta) {
				    top_mover.delta = delta;
				    top_mover.athlete = athlete;
				}	
				if ( athlete.place < athlete.place_prev) {
				   delta = '&#8593;' + delta + ' position(s)';
				} else if ( athlete.place > athlete.place_prev ) {
				   delta = '&#8595;' + delta + ' position(s)';
				} else 	{
				   delta = '';
				}

				console.log(athlete);
				$('#text').append( athlete.place 
					+ ') ' 
					+ athlete.family_name 
					+ ', ' 
					+ athlete.given_name 
					+ ' (' 
					+ athlete.country_short 
					+ ') ' 
					+ delta 
					+ ' (' 
					+ athlete.points 
					+ ' points) ' 
					+'<br />'
				);
				total_athletes++;
			}
		});

	//	console.log(value);
	//	$('#text').append( ' ' + data.categories[1].competitors[0].family_name );

	});

	$('#text').prepend('<p>Total Athletes shown:' + total_athletes);
	$('#text').prepend('<p>Top Mover:' + top_mover.delta + ' ' + top_mover.athlete.family_name);

});
</script>


</body>
</html>
